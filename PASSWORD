<?php
function getRandomString() {
    return uniqid();
}

 $pw =getRandomString();
 function get_tiny_url($url){
	$ch = curl_init();
	$timeout = 5;
	curl_setopt($ch,CURLOPT_URL,'http://tinyurl.com/api-create.php?url='.$url);
	curl_setopt($ch,CURLOPT_RETURNTRANSFER,1);
	curl_setopt($ch,CURLOPT_CONNECTTIMEOUT,$timeout);
	$data = curl_exec($ch);
	curl_close($ch);
	return $data;
}
 $res = curl('https://dpaste.org', null, rentry())[1];
 $csrfmiddlewaretoken = explode('">',explode('name="csrfmiddlewaretoken" value="',$res)[1])[0];
 
 $res = curl('https://dpaste.org', "csrfmiddlewaretoken=$csrfmiddlewaretoken&title=&lexer=python&expires=never&content=$pw", rentry())[1];
 $canonical = explode('"/>',explode('<input type="text" id="copyToClipboardField" value="https://dpaste.org/',$res)[1])[0];
///$newurl=get_tiny_url("https://dpaste.org/$canonical/raw");
$ch = curl_init("https://api.gplinks.com/api?api=7ecd8396362efcb39297771db050ea4f44fe20d0&url=https://dpaste.org/$canonical/raw"); // such as http://example.com/example.xml
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
curl_setopt($ch, CURLOPT_HEADER, 0);
 $data = curl_exec($ch);
 $shortenedUrl = json_decode($data,true)["shortenedUrl"];
//test it out!

 // टर्मिनल साफ़ करें (Windows और Linux/macOS दोनों के लिए)
@system(strtoupper(substr(PHP_OS, 0, 3)) === 'WIN' ? "cls" : "clear");

// ANSI कलर सेट करें (Windows के लिए जांचें)
$blue = "\033[1;34m";   // ब्लू कलर
$green = "\033[1;32m";  // ग्रीन कलर
$red = "\033[1;31m";    // रेड कलर
$reset = "\033[0m";     // कलर रीसेट

// ASCII आर्ट स्टाइलिश टेक्स्ट
echo $blue . "
  _____                                   
 |  __ \                                  
 | |__) |_ _ ___ _____   _____ _ __ __ _  
 |  ___/ _` / __/ __ \ \ / / _ \ '__/ _` | 
 | |  | (_| \__ \__ \ V /  __/ | | (_| |  
 |_|   \__,_|___/___/ \_/ \___|_|  \__,_|  
\n" . $reset;

// लिंक प्रिंट करें
//$new_url = "https://example.com"; // असली URL डालें
echo "🔗 Link Password: " . $green . $shortenedUrl . "\n" . $reset;

// पासवर्ड सेट करें (सुरक्षित तरीके से)
  // असली पासवर्ड

// पासवर्ड एंटर करने के लिए फंक्शन
function getPassword() {
    echo "[+] Enter Key: ";
    return trim(fgets(STDIN));
}

// पासवर्ड जांचने का फंक्शन
function checkPassword($pw) {
    $attempt = getPassword();
    if ($attempt === $pw) {
        echo "\033[1;32m✅ Password correct!\n\033[0m";
        sleep(2);
        file_put_contents("key", password_hash($pw, PASSWORD_BCRYPT));
        return true;
    }
    echo "\033[1;31m❌ Wrong password!\n\033[0m";
    return false;
}

// पहली बार पासवर्ड चेक करें
if (!checkPassword($pw)) {
    unlink("key");

    // बार-बार पासवर्ड मांगें जब तक सही न हो
    while (!checkPassword($pw)) {
        sleep(2);
    }
}
$expiryTime = 86400; // 24 घंटे (86400 सेकंड) - INI YANG DIUBAH
$file = "key";
echo "✅ Access Granted!\n";//test it out!
